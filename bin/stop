#!/usr/bin/env ruby

# Command:
# bin/stop --all

require "fileutils"

files = Dir.glob("#{File.dirname(__dir__)}/tmp/pids/*.pid")

if ARGV.index("--all")
  puts "Stop all Thin servers."
  `pkill -KILL -f "thin server"`
elsif files.size == 0
  puts "Thin server is not running."
else
  files.each do |file|
    pid = File.read(file)
    puts "Stop Thin server. [PID=#{pid}]"
    `kill -9 #{pid}` if `ps aux | grep "[t]hin server" | grep #{pid}`.strip != ""
    FileUtils.rm_rf file
  end
end

puts "\n" + ("-"*80) + "\n" + `ps aux | grep "[t]hin server\\|[P]ID"`.strip + "\n" + ("-"*80)
