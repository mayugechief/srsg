(function(){$(function(){$("form .mod-event").length&&($(".mod-event button:button.add-date").click(function(){$(".mod-event dd.dates").length<Event_Form.maxTermForm&&Event_Form.cloneTermForm()}),$(".mod-event button:button.clear").click(function(){var t,e;e=$(this).parent("dd").find(".start").val(),t=$(this).parent("dd").find(".close").val(),""!==e||""!==t?confirm(Event_Form.deleteMessage)&&Event_Form.clearTermForm($(this).parent("dd")):Event_Form.clearTermForm($(this).parent("dd"))}),$("form").submit(function(){var t,e,n,a,r,d;for(a=$(".mod-event dd.dates"),e=[],r=0,d=a.length;d>r;r++)n=a[r],t=Event_Form.termToDates($(n).find(".start").val(),$(n).find(".close").val()),e=e.concat(t);$(".mod-event .event-dates").val(Event_Form.datesToString(e))}),Event_Form.setStoredDates())}),this.Event_Form=function(){function t(){}return t.maxTermForm=10,t.deleteMessage="\u30a4\u30d9\u30f3\u30c8\u65e5\u3092\u524a\u9664\u3057\u3066\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f",t.dateToString=function(t){var e,n,a;return a=t.getYear(),n=t.getMonth()+1,e=t.getDate(),2e3>a&&(a+=1900),10>n&&(n="0"+n),10>e&&(e="0"+e),a+"/"+n+"/"+e},t.datesToString=function(t){var e,n,a,r,d,o,i,s;for(r=[],d=0,i=t.length;i>d;d++){for(e=t[d],n=0;n<r.length&&this.dateToString(e)!==this.dateToString(r[n]);)n++;n===r.length&&r.push(e)}for(t=r,t.sort(function(t,e){return t-e}),a="",o=0,s=t.length;s>o;o++)e=t[o],a+=this.dateToString(e),a+="\r\n";return a},t.isValidDate=function(t){return"[object Date]"!==Object.prototype.toString.call(t)?!1:!isNaN(t.getTime())&&t.getYear()>0?!0:!1},t.termToDates=function(t,e){var n,a,r,d;if(d=new Date(t),n=new Date(e),r=[],this.isValidDate(d)&&this.isValidDate(n))for(a=new Date(d);n>=a;)r.push(new Date(a)),a.setDate(a.getDate()+1);else this.isValidDate(d)?r.push(new Date(d)):this.isValidDate(n)&&r.push(new Date(n));return r},t.datesToTerm=function(t){var e,n,a,r,d,o,i;for(r=[],a=[],n=o=0,i=t.length;i>o;n=++o)e=t[n],a.push(e),d=new Date(e),d.setDate(d.getDate()+1),n+1<t.length&&this.dateToString(t[n+1])!==this.dateToString(d)&&(r.push([a[0],a[a.length-1]]),a=[]);return a.length>=1&&r.push([a[0],a[a.length-1]]),r},t.setStoredDates=function(){var t,e,n,a,r,d,o,i,s,l,m,v;for(r=$(".mod-event .event-dates").val().split(/\r\n|\n/),n=[],i=0,l=r.length;l>i;i++)t=r[i],e=new Date(t),this.isValidDate(e)&&n.push(e);for(o=this.datesToTerm(n),v=[],a=s=0,m=o.length;m>s;a=++s)d=o[a],0!==a&&this.cloneTermForm(),$(".mod-event dd.dates:last").find(".start").val(this.dateToString(d[0])),v.push($(".mod-event dd.dates:last").find(".close").val(this.dateToString(d[1])));return v},t.cloneTermForm=function(){var e;return e=$(".mod-event dd.dates:last").clone(!1).insertAfter($(".mod-event dd.dates:last")),e.find(".start").val(""),e.find(".close").val(""),e.find(".clear").click(function(){var e,n;n=$(this).parent("dd").find(".start").val(),e=$(this).parent("dd").find(".close").val(),""!==n||""!==e?confirm(t.deleteMessage)&&t.clearTermForm($(this).parent("dd")):t.clearTermForm($(this).parent("dd"))}),$(".mod-event .date").attr("id","").datetimepicker({lang:"ja",timepicker:!1,format:"Y/m/d"}),$(".mod-event dd.dates").length>=this.maxTermForm?$(".mod-event button:button.add-date").attr("disabled",!0):void 0},t.clearTermForm=function(t){return t.find(".start").val(""),t.find(".close").val(""),$(".mod-event dd.dates").length>1&&t.remove(),$(".mod-event dd.dates").length<this.maxTermForm?$(".mod-event button:button.add-date").removeAttr("disabled"):void 0},t}()}).call(this);